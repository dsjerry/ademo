<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blob特性使用示例</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        dark: '#1E293B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
            .transition-height {
                transition: max-height 0.3s ease-in-out;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-dark">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <header class="mb-12 text-center">
            <h1 class="text-[clamp(1.8rem,5vw,2.8rem)] font-bold text-dark mb-4">Blob 特性使用示例</h1>
            <p class="text-gray-600 max-w-2xl mx-auto">展示 JavaScript 中 Blob 对象的五个主要特性及其实践应用</p>
        </header>

        <!-- 1. 不可逆性示例 -->
        <section class="mb-10 bg-white rounded-xl p-6 card-shadow">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-lock text-primary text-xl"></i>
                </div>
                <h2 class="text-xl font-semibold">1. 不可逆性</h2>
            </div>
            <p class="text-gray-600 mb-4">Blob 创建后内容不可更改，修改需创建新 Blob</p>
            
            <div class="space-y-4">
                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="createBlobBtn" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-all">
                        创建原始 Blob
                    </button>
                    <button id="modifyBlobBtn" class="bg-accent hover:bg-accent/90 text-white px-6 py-2 rounded-lg transition-all">
                        尝试修改（创建新 Blob）
                    </button>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <h3 class="font-medium mb-2">结果:</h3>
                    <pre id="immutableResult" class="text-sm text-gray-700 overflow-x-auto"></pre>
                </div>
            </div>
        </section>

        <!-- 2. 切片功能示例 -->
        <section class="mb-10 bg-white rounded-xl p-6 card-shadow">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-secondary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-scissors text-secondary text-xl"></i>
                </div>
                <h2 class="text-xl font-semibold">2. 切片功能</h2>
            </div>
            <p class="text-gray-600 mb-4">使用 slice() 方法从现有 Blob 创建新 Blob（大文件分片上传场景）</p>
            
            <div class="space-y-4">
                <div>
                    <input type="file" id="fileInput" class="border border-gray-300 rounded-lg p-2 w-full" accept="*">
                </div>
                <button id="sliceBlobBtn" class="bg-secondary hover:bg-secondary/90 text-white px-6 py-2 rounded-lg transition-all">
                    分片处理文件
                </button>
                
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 overflow-hidden">
                    <h3 class="font-medium mb-2">分片结果:</h3>
                    <div id="sliceResult" class="text-sm text-gray-700 max-h-60 overflow-y-auto"></div>
                </div>
            </div>
        </section>

        <!-- 3. MIME类型示例 -->
        <section class="mb-10 bg-white rounded-xl p-6 card-shadow">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center mr-3">
                    <i class="fa fa-file-text-o text-purple-600 text-xl"></i>
                </div>
                <h2 class="text-xl font-semibold">3. MIME类型</h2>
            </div>
            <p class="text-gray-600 mb-4">type 属性表明数据的 MIME 类型，如图片、文本等</p>
            
            <div class="space-y-4">
                <div class="flex flex-wrap gap-3">
                    <button data-mime="text/plain" class="mime-btn bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-all">
                        文本 (text/plain)
                    </button>
                    <button data-mime="image/png" class="mime-btn bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-all">
                        图片 (image/png)
                    </button>
                    <button data-mime="application/json" class="mime-btn bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-all">
                        JSON (application/json)
                    </button>
                    <button data-mime="audio/mpeg" class="mime-btn bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-all">
                        音频 (audio/mpeg)
                    </button>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <h3 class="font-medium mb-2">Blob 信息:</h3>
                    <pre id="mimeResult" class="text-sm text-gray-700"></pre>
                </div>
            </div>
        </section>

        <!-- 4. URL生成示例 -->
        <section class="mb-10 bg-white rounded-xl p-6 card-shadow">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-3">
                    <i class="fa fa-link text-green-600 text-xl"></i>
                </div>
                <h2 class="text-xl font-semibold">4. URL生成</h2>
            </div>
            <p class="text-gray-600 mb-4">通过 URL.createObjectURL() 为 Blob 生成临时 URL</p>
            
            <div class="space-y-4">
                <div class="flex flex-wrap gap-3">
                    <button id="createImageUrlBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all">
                        生成图片 Blob URL
                    </button>
                    <button id="revokeUrlBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all">
                        释放 URL (revoke)
                    </button>
                </div>
                
                <div id="imageContainer" class="bg-gray-50 p-4 rounded-lg border border-gray-200 min-h-[150px] flex items-center justify-center">
                    <p class="text-gray-400">图片将显示在这里</p>
                </div>
                
                <div class="text-sm text-gray-500">
                    <p>提示: 使用 URL.createObjectURL() 后，记得用 URL.revokeObjectURL() 释放资源</p>
                </div>
            </div>
        </section>

        <!-- 5. 文件操作示例 -->
        <section class="mb-10 bg-white rounded-xl p-6 card-shadow">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                    <i class="fa fa-upload text-blue-600 text-xl"></i>
                </div>
                <h2 class="text-xl font-semibold">5. 文件操作</h2>
            </div>
            <p class="text-gray-600 mb-4">File 接口继承自 Blob，可作为文件使用（如表单提交）</p>
            
            <div class="space-y-4">
                <div>
                    <input type="file" id="formFileInput" class="border border-gray-300 rounded-lg p-2 w-full" accept="image/*">
                </div>
                
                <form id="fileForm" class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <h3 class="font-medium mb-2">模拟表单提交:</h3>
                    <div class="flex gap-3">
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all">
                            提交文件
                        </button>
                        <button type="button" id="createCustomFileBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-all">
                            创建自定义文件
                        </button>
                    </div>
                </form>
                
                <div id="fileSubmitResult" class="hidden bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <h3 class="font-medium mb-2">提交结果:</h3>
                    <pre id="fileResult" class="text-sm text-gray-700"></pre>
                </div>
            </div>
        </section>
    </div>

    <script>
        // 1. 不可逆性示例
        let originalBlob;
        document.getElementById('createBlobBtn').addEventListener('click', () => {
            // 创建原始Blob
            originalBlob = new Blob(['这是原始的Blob内容'], { type: 'text/plain' });
            
            // 读取内容并显示
            const reader = new FileReader();
            reader.onload = () => {
                document.getElementById('immutableResult').textContent = 
                    `原始Blob内容: ${reader.result}\n` +
                    `Blob大小: ${originalBlob.size} 字节`;
            };
            reader.readAsText(originalBlob);
        });

        document.getElementById('modifyBlobBtn').addEventListener('click', () => {
            if (!originalBlob) {
                alert('请先创建原始Blob');
                return;
            }
            
            // 无法直接修改现有Blob，必须创建新的
            const reader = new FileReader();
            reader.onload = () => {
                // 读取原始内容并添加新内容
                const newContent = reader.result + ' - 这是添加的新内容';
                const newBlob = new Blob([newContent], { type: 'text/plain' });
                
                // 显示新旧Blob对比
                const newReader = new FileReader();
                newReader.onload = () => {
                    document.getElementById('immutableResult').textContent += 
                        `\n\n原始Blob无法修改，已创建新Blob:\n` +
                        `新Blob内容: ${newReader.result}\n` +
                        `新Blob大小: ${newBlob.size} 字节`;
                };
                newReader.readAsText(newBlob);
            };
            reader.readAsText(originalBlob);
        });

        // 2. 切片功能示例
        document.getElementById('sliceBlobBtn').addEventListener('click', () => {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('请先选择一个文件');
                return;
            }
            
            const sliceResult = document.getElementById('sliceResult');
            sliceResult.innerHTML = '';
            
            // 分片大小：1MB
            const chunkSize = 1024 * 1024;
            const totalChunks = Math.ceil(file.size / chunkSize);
            
            sliceResult.innerHTML += `<p>文件名称: ${file.name}</p>`;
            sliceResult.innerHTML += `<p>文件大小: ${(file.size / (1024 * 1024)).toFixed(2)} MB</p>`;
            sliceResult.innerHTML += `<p>分片大小: 1 MB</p>`;
            sliceResult.innerHTML += `<p>总分片数: ${totalChunks}</p>`;
            sliceResult.innerHTML += `<hr>`;
            
            // 分片处理
            for (let i = 0; i < totalChunks; i++) {
                const start = i * chunkSize;
                const end = Math.min(start + chunkSize, file.size);
                
                // 使用slice方法创建分片
                const chunk = file.slice(start, end);
                
                // 显示分片信息
                const chunkInfo = document.createElement('div');
                chunkInfo.className = 'mb-2 p-2 bg-blue-50 rounded';
                chunkInfo.innerHTML = `
                    分片 #${i + 1}:<br>
                    范围: ${start} - ${end} 字节<br>
                    大小: ${chunk.size} 字节
                `;
                sliceResult.appendChild(chunkInfo);
            }
        });

        // 3. MIME类型示例
        document.querySelectorAll('.mime-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const mime = btn.getAttribute('data-mime');
                let content, description;
                
                // 根据MIME类型创建不同内容
                switch (mime) {
                    case 'text/plain':
                        content = '这是一个纯文本内容示例';
                        description = '文本内容';
                        break;
                    case 'image/png':
                        content = 'PNG图像二进制数据表示';
                        description = 'PNG图像文件';
                        break;
                    case 'application/json':
                        content = JSON.stringify({ name: '示例', type: 'JSON', value: 123 });
                        description = 'JSON数据';
                        break;
                    case 'audio/mpeg':
                        content = 'MP3音频二进制数据表示';
                        description = 'MP3音频文件';
                        break;
                }
                
                // 创建具有指定MIME类型的Blob
                const blob = new Blob([content], { type: mime });
                
                // 显示Blob信息
                document.getElementById('mimeResult').textContent = 
                    `Blob内容: ${content}\n` +
                    `MIME类型: ${blob.type}\n` +
                    `描述: ${description}\n` +
                    `大小: ${blob.size} 字节`;
            });
        });

        // 4. URL生成示例
        let objectUrl;
        document.getElementById('createImageUrlBtn').addEventListener('click', () => {
            // 创建一个简单的图片Blob（实际应用中可能来自文件或网络）
            // 这里使用Base64编码的小图片作为示例
            const base64Data = 'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==';
            const byteCharacters = atob(base64Data);
            const byteNumbers = new Array(byteCharacters.length);
            
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], { type: 'image/png' });
            
            // 生成Object URL
            objectUrl = URL.createObjectURL(blob);
            
            // 在页面上显示图片
            const imageContainer = document.getElementById('imageContainer');
            imageContainer.innerHTML = `
                <img src="${objectUrl}" alt="示例图片" class="max-h-40">
                <p class="mt-2 text-sm text-gray-500">临时URL: ${objectUrl.substring(0, 50)}...</p>
            `;
        });

        document.getElementById('revokeUrlBtn').addEventListener('click', () => {
            if (objectUrl) {
                // 释放URL
                URL.revokeObjectURL(objectUrl);
                objectUrl = null;
                
                const imageContainer = document.getElementById('imageContainer');
                imageContainer.innerHTML = '<p class="text-gray-400">URL已释放，图片无法再显示</p>';
            } else {
                alert('请先创建图片URL');
            }
        });

        // 5. 文件操作示例
        document.getElementById('fileForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const fileInput = document.getElementById('formFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('请先选择一个文件');
                return;
            }
            
            // 模拟表单提交
            const formData = new FormData();
            formData.append('file', file);
            formData.append('filename', file.name);
            formData.append('timestamp', new Date().toISOString());
            
            // 显示提交信息
            const resultDiv = document.getElementById('fileSubmitResult');
            const resultContent = document.getElementById('fileResult');
            
            resultContent.textContent = 
                `提交的文件信息:\n` +
                `名称: ${file.name}\n` +
                `类型: ${file.type}\n` +
                `大小: ${file.size} 字节\n` +
                `最后修改: ${new Date(file.lastModified).toLocaleString()}\n\n` +
                `File 继承自 Blob: ${file instanceof Blob ? '是' : '否'}`;
            
            resultDiv.classList.remove('hidden');
        });

        document.getElementById('createCustomFileBtn').addEventListener('click', () => {
            // 创建自定义内容
            const content = '这是通过Blob创建的自定义文本文件内容';
            const blob = new Blob([content], { type: 'text/plain' });
            
            // 创建File对象（继承自Blob）
            const customFile = new File([blob], 'custom-file.txt', {
                type: 'text/plain',
                lastModified: Date.now()
            });
            
            // 模拟将自定义文件添加到表单
            const resultDiv = document.getElementById('fileSubmitResult');
            const resultContent = document.getElementById('fileResult');
            
            resultContent.textContent = 
                `创建的自定义文件:\n` +
                `名称: ${customFile.name}\n` +
                `类型: ${customFile.type}\n` +
                `大小: ${customFile.size} 字节\n` +
                `内容: ${content}\n\n` +
                `可以像普通文件一样提交到服务器`;
            
            resultDiv.classList.remove('hidden');
        });
    </script>
</body>
</html>
